@model EmployeeEditViewModel

<form method="post" asp-action="UserEdit" id="edit-employee-form">
    <div class="page-wrapper">
        <div class="content">
            <div class="page-header">
                <div class="page-title">
                    <h4>User Management</h4>
                    <h6>Edit/Update User</h6>
                </div>
            </div>

            <input type="hidden" id="originalFirstName" value="@Model.User.FirstName" />
            <input type="hidden" id="originalLastName" value="@Model.User.LastName" />
            <input type="hidden" id="originalEmail" value="@Model.User.Email" />
            <input type="hidden" id="originalPhoneNumber" value="@Model.User.PhoneNumber" />
            <input type="hidden" id="originalUserName" value="@Model.User.UserName" asp-for="OriginalUserName"/>
            <input type="hidden" id="originalRole" value="@Model.Role" />

            <div class="text-danger" asp-validation-summary="All"></div>
            <div id="resultMessage" class="text-danger"></div>


            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 col-sm-6 col-12">
                            <div class="form-group">
                                <label>First Name</label>
                                <input asp-for="User.FirstName" type="text">
                            </div>
                            <div class="form-group">
                                <label>User Name</label>
                                <input asp-for="User.UserName" type="text">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input asp-for="User.Email" type="text">
                            </div>
                        </div>

                        <div class="col-lg-3 col-sm-6 col-12">
                            <div class="form-group">
                                <label>Last Name</label>
                                <input asp-for="User.LastName" type="text">
                            </div>
                            <div class="form-group">
                                <label>Mobile</label>
                                <input asp-for="User.PhoneNumber" type="text">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select class="form-select" asp-for="Role" required>
                                    <option value="-1">Choose Role</option>
                                    @if (Model.IdentityRoles is not null)
                                    {
                                        @foreach (var role in Model.IdentityRoles)
                                        {
                                            if(role.Name == Model.Role)
                                            {
                                                <option value="@role.Name" selected>@role.Name</option>
                                            }
                                            else
                                            {
                                                <option value="@role.Name">@role.Name</option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6 col-12">
                            <div class="form-group">
                                <label> Profile Picture</label>
                                <div class="image-upload image-upload-new">
                                    <input type="file">
                                    <div class="image-uploads">
                                        <img src="~/img/icons/upload.svg" alt="img">
                                        <h4>Drag and drop a file to upload</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <button type="submit" class="btn btn-submit me-2">Submit</button>
                            <a asp-controller="Employee" asp-action="UserLists" class="btn btn-cancel">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</form>


@section Scripts
{
    <script>
        $(document).ready(function () 
        {
            $('#edit-employee-form').validate();

            $(".btn-submit").on("click", function (e)
            {
                 e.preventDefault();

                if ($('#edit-employee-form').valid()) {
                    document.getElementById('edit-employee-form').dispatchEvent(new Event('submit'));
                }
            });
        });


        document.addEventListener('DOMContentLoaded', function ()
        {
            document.getElementById('edit-employee-form').addEventListener('submit', function (event)
            {
                var originalFirstName = document.getElementById('originalFirstName').value;
                var originalLastName = document.getElementById('originalLastName').value;
                var originalEmail = document.getElementById('originalEmail').value;
                var originalPhoneNumber = document.getElementById('originalPhoneNumber').value;
                var originalUserName = document.getElementById('originalUserName').value;
                var originalRole = document.getElementById('originalRole').value;

                var currentFirstName = document.getElementById('User_FirstName').value;
                var currentLastName = document.getElementById('User_LastName').value;
                var currentEmail = document.getElementById('User_Email').value;
                var currentPhoneNumber = document.getElementById('User_PhoneNumber').value;
                var currentUserName = document.getElementById('User_UserName').value;
                var currentRole = document.getElementById('Role').value;

                if (originalFirstName === currentFirstName &&
                    originalLastName === currentLastName &&
                    originalEmail === currentEmail &&
                    originalPhoneNumber === currentPhoneNumber &&
                    originalUserName === currentUserName &&
                    originalRole === currentRole)
                {
                    event.preventDefault();


                    var resultMessage = document.getElementById('resultMessage');

                    resultMessage.innerText = 'No changes detected. Form not submitted.';
                    return;
                }
                else
                {
                    showSubmitConfirmation('/Employee/UserEdit', "Employee", "#edit-employee-form", function () {
                        window.location.href = '/Employee/UserLists';
                    });
                }
            });
        });

    </script>
}